<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
    <script>
        const experimentKey = 'boxingClassABTest_v1'; // Unique key for this specific experiment
        const participationFlagKey = `${experimentKey}_participated`;
        const assignedVersionKey = `${experimentKey}_assignedVersion`;

        // Check if user has participated before in this specific experiment
        const hasParticipated = localStorage.getItem(participationFlagKey);
        const previouslyAssignedVersion = localStorage.getItem(assignedVersionKey);

        if (hasParticipated && previouslyAssignedVersion) {
            // User has participated before, send them to their previously assigned version with a revisit flag
            console.log(`User has participated. Re-assigning to version: ${previouslyAssignedVersion} as revisit.`);
            if (previouslyAssignedVersion === 'A') {
                window.location.href = `versionA.html?version=A&revisit=true`;
            } else { // Must be 'B'
                window.location.href = `versionB.html?version=B&revisit=true`;
            }
        } else {
            // First time participation for this experiment
            console.log("First time participation in this experiment.");
            localStorage.setItem(participationFlagKey, 'true'); // Set participation flag for this experiment

            // Decide which version to show (A or B)
            const version = Math.random() < 0.5 ? 'A' : 'B';
            localStorage.setItem(assignedVersionKey, version); // Store assigned version for this experiment

            // Redirect to the chosen version
            if (version === 'A') {
                window.location.href = `versionA.html?version=A`;
            } else {
                window.location.href = `versionB.html?version=B`;
            }
        }
    </script>
</head>
<body>
    <p>If you are not redirected automatically, please refresh the page or clear your browser's site data for this page and try again.</p>
    <!--
        A manual link is harder here because the localStorage logic runs first.
        If JS is disabled, this page won't work as intended anyway.
    -->
</body>
</html>
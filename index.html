<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
    <script>
        const experimentKey = 'boxingClassABTest_v1';
        const participationFlagKey = `${experimentKey}_participated`;
        const assignedVersionKey = `${experimentKey}_assignedVersion`;

        const hasParticipated = localStorage.getItem(participationFlagKey);
        const previouslyAssignedVersion = localStorage.getItem(assignedVersionKey);

        if (hasParticipated === 'true' && previouslyAssignedVersion) {
            console.log("INDEX: User has participated flag and stored version. Redirecting to already_participated.html.");
            window.location.href = 'already_participated.html';
        } else {
            console.log("INDEX: New user or incomplete previous participation. Assigning version and setting flag.");
            localStorage.setItem(participationFlagKey, 'true');
            const versionToAssign = Math.random() < 0.5 ? 'A' : 'B';
            localStorage.setItem(assignedVersionKey, versionToAssign);

            if (versionToAssign === 'A') {
                window.location.href = `versionA.html?version=A&newbie=true`;
            } else { // versionToAssign === 'B'
                window.location.href = `versionB.html?version=B&newbie=true`;
            }
        }
    </script>
</head>
<body>
    <p>Redirecting...</p>
</body>
</html>